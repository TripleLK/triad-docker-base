#+TITLE: Cosmic Forge Next Steps - 3-Level Menu Hierarchy
#+AUTHOR: Cosmic Forge  
#+DATE: 2025-01-08
#+FILETAGS: :next-steps:cosmic-forge:architecture:

* ğŸ¯ PRIMARY OBJECTIVE
Implement a 3-level menu hierarchy for better nested field management:
**Root â†’ objects â†’ objects[0]** (instead of current Root â†’ objects[0])

* ğŸ—ï¸ REQUIRED ARCHITECTURE CHANGES

** Level 1: Standard Fields Menu (âœ… Already Working)
- Current field selection menu is working correctly
- Keep existing functionality unchanged
- Fields with ğŸ—ï¸ icon should trigger Level 2 menu

** Level 2: NEW - Instance Management Menu  
This is the **main task** - create a new intermediate menu that shows:

*** Visual Layout
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ Nested Field: models             â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                     â”‚
â”‚ [models[0]] [models[1]] [+ Add New] â”‚
â”‚                                     â”‚
â”‚ Breadcrumb: Root â†’ models           â”‚
â”‚ [â¬†ï¸ Parent] [Close Menu]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

*** Required Functionality
- Show existing instances as clickable buttons: `[models[0]]`, `[models[1]]`, etc.
- `[+ Add New]` button to create new instances
- Breadcrumb shows: `Root â†’ objects` (not `Root â†’ objects[0]`)
- Click instance button â†’ go to Level 3 (individual editing)

** Level 3: Instance Detail Menu (âœ… Foundation Exists)  
- Current sub-menu structure can be reused
- Shows individual field editing interface
- Breadcrumb shows: `Root â†’ objects â†’ objects[0]`

* ğŸ”§ IMPLEMENTATION STEPS

** Step 1: Create Instance Management Menu Function
- Add new JavaScript function: `showInstanceManagementMenu(fieldName)`
- Generate HTML for instance buttons and + Add button
- Handle breadcrumb navigation: `Root â†’ fieldName`

** Step 2: Update Field Menu Click Handlers
- When clicking nested field (ğŸ—ï¸), call `showInstanceManagementMenu()` instead of direct entry
- Modify existing `enterNestedField()` to go through instance management

** Step 3: Update Instance Management Logic
- `[+ Add New]` button â†’ determines next available index and creates new instance
- `[models[0]]` button â†’ enters that specific instance (current Level 3 functionality)

** Step 4: Fix Breadcrumb Navigation
- Update `navigate_to_parent()` to handle 3-level hierarchy
- Root â†’ objects â†’ objects[0] navigation should work correctly

* ğŸ“‚ KEY FILES TO MODIFY

** `apps/content_extractor/selectors/interactive_selector.py`
- **Lines ~710-720**: Update `enterNestedField()` function
- **Lines ~600-650**: Add instance management menu HTML
- **Lines ~2944-2980**: Update action handling for new hierarchy
- **Add new method**: `show_instance_management_menu(field_name)`

** Priority Functions to Add:
1. `showInstanceManagementMenu(fieldName)` - JavaScript
2. `show_instance_management_menu(field_name)` - Python  
3. Update breadcrumb navigation logic
4. Handle instance button clicks

* ğŸ§ª TESTING APPROACH

** Test Sequence
1. Load test page: `https://www.airscience.com/product-category-page?brandname=safefume-fuming-chambers&brand=14`
2. Click field menu â†’ Click nested field (ğŸ—ï¸)
3. **Expected**: See instance management menu with `[models[0]]` and `[+ Add]`
4. Click `[+ Add]` â†’ Should create `[models[1]]` button
5. Click `[models[1]]` â†’ Should enter detailed editing mode
6. **Breadcrumb should show**: `Root â†’ models â†’ models[1]`

** Success Criteria
- âœ… Three-level navigation working smoothly
- âœ… Instance management intuitive and clear  
- âœ… + Add button creates new instances correctly
- âœ… Breadcrumb navigation accurate at all levels

* âš ï¸ CRITICAL NOTES

** Current Issues to Address
- Sub-menu reliability problems in normal usage
- Direct Root â†’ objects[0] approach is confusing
- Instance management is not intuitive

** Don't Break
- Level 1 standard field menu (working correctly)
- Draggable functionality (fixed by Thunder Apex)
- Field selection and saving (core functionality)

** Architecture Principle
Each level should have a **clear, single purpose**:
- Level 1: Choose field type
- Level 2: Manage instances of that field  
- Level 3: Edit individual instance details

* ğŸš€ EXPECTED OUTCOME
Users can easily:
1. Select a nested field type
2. See and manage all instances of that field
3. Add new instances intuitively
4. Edit individual instances in detail
5. Navigate back through clear breadcrumb hierarchy 