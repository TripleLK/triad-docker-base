{% extends "base_site/base.html" %}
{% load wagtailcore_tags wagtailimages_tags static %}

{% block extra_head %}
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/lab_equipment_page.css' %}"  />
{% endblock %}

{% block content %}
<section class="info-page-frame">
  <!-- Product Image and Title Section -->
  <div class="product-image-container">
    {% if page.main_image %}
    {% with img_url=page.main_image %}
    <img id="featured-img" src="{{ img_url }}" alt="{{ page.title }}" class="product-detail-image" onerror="this.src='{% static 'img/default-image.jpg' %}'">
    {% endwith %}
    {% else %}
    <img id="featured-img" src="{% static 'img/default-image.jpg' %}" alt="{{ page.title }}" class="product-detail-image">
    {% endif %}
    
    <!-- Thumbnails Gallery -->
    {% if page.gallery_images.all %}
    <div class="thumbnail-gallery">
      {% for gallery_item in page.gallery_images.all %}
      {% with img_url=gallery_item.get_image_url %}
      {% if img_url %}
      <img class="gallery-thumbnail" src="{{ img_url }}" alt="Gallery Image" onerror="this.src='{% static 'img/default-image.jpg' %}'" data-full="{{ img_url }}">
      {% endif %}
      {% endwith %}
      {% endfor %}
    </div>
    {% endif %}
  </div>
  
  <h2 class="machine-title">{{ page.title }}</h2>
  <div class="product-description">
    {{ page.short_description|richtext }}
  </div>
  
  <!-- Full Description Accordion -->
  <div class="more-details-box-frame">
    <div class="long-description-box">
      <div class="details-header" id="full-description-header">
        <h3 class="read-more-details">Read More Details</h3>
        <img src="{% static 'img/expand-icon.svg' %}" alt="Expand Icon" class="expand-icon" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTkgOUwxMiAxNkw1IDlaIiBmaWxsPSIjMkIyNjEwIi8+PC9zdmc+'" />
      </div>
      <div class="full-description" id="full-description-content">
        {{ page.full_description|richtext }}
      </div>
    </div>
  </div>
  
  <h2 class="modelsand-specifications">Models and Specifications</h2>
  
  <!-- Model Specification Sections -->
  {% if page.models.all %}
  {% for model in page.models.all %}
  <div class="model-accordion">
    <div class="model-accordion-header">
      <h3 class="model-name">{{ model.name }}</h3>
      <div class="header-right">
        <a href="#" class="quote-button">
          <button>Add to Quote Cart</button>
        </a>
        <img src="{% static 'img/expand-icon-dark.svg' %}" alt="Expand Icon" class="expand-icon" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTkgOUwxMiAxNkw1IDlaIiBmaWxsPSIjMkIyNjEwIi8+PC9zdmc+'" />
      </div>
    </div>
    <div class="model-accordion-content">
      <!-- Specification Accordions -->
      {% for group in model.merged_spec_groups %}
      {% if group.specs %}
      <div class="faq-accordion">
        <div class="heading">
          <h4 class="specification">{{ group.name }}</h4>
          <img src="{% static 'img/expand-icon.svg' %}" alt="Expand Icon" class="expand-icon" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTkgOUwxMiAxNkw1IDlaIiBmaWxsPSIjMkIyNjEwIi8+PC9zdmc+'" />
        </div>
        <div class="spec-content">
          <table class="spec-table">
            <tbody>
              {% for spec in group.specs %}
              <tr>
                <td>{{ spec.key }}</td>
                <td>{{ spec.value }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      {% endif %}
      {% endfor %}
    </div>
  </div>
  {% endfor %}
  {% else %}
  <!-- Single Product Specification Section (no models) -->
  <div class="model-accordion">
    <div class="model-accordion-header">
      <h3 class="model-name">{{ page.title }}</h3>
      <div class="header-right">
        <a href="#" class="quote-button">
          <button>Add to Quote Cart</button>
        </a>
        <img src="{% static 'img/expand-icon-dark.svg' %}" alt="Expand Icon" class="expand-icon" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTkgOUwxMiAxNkw1IDlaIiBmaWxsPSIjMkIyNjEwIi8+PC9zdmc+'" />
      </div>
    </div>
    <div class="model-accordion-content">
      <!-- Specification Accordions -->
      {% for group in page.get_effective_spec_groups %}
      {% if group.specs %}
      <div class="faq-accordion">
        <div class="heading">
          <h4 class="specification">{{ group.name }}</h4>
          <img src="{% static 'img/expand-icon.svg' %}" alt="Expand Icon" class="expand-icon" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTkgOUwxMiAxNkw1IDlaIiBmaWxsPSIjMkIyNjEwIi8+PC9zdmc+'" />
        </div>
        <div class="spec-content">
          <table class="spec-table">
            <tbody>
              {% for spec in group.specs %}
              <tr>
                <td>{{ spec.key }}</td>
                <td>{{ spec.value }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      {% endif %}
      {% endfor %}
    </div>
  </div>
  {% endif %}
</section>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Gallery Thumbnail Behavior
  const featuredImg = document.getElementById('featured-img');
  const thumbnails = document.querySelectorAll('.gallery-thumbnail');
  
  thumbnails.forEach(thumb => {
    thumb.addEventListener('click', function() {
      // Remove active class from all thumbnails
      thumbnails.forEach(t => t.classList.remove('active'));
      
      // Add active class to clicked thumbnail
      this.classList.add('active');
      
      // Set the featured image source
      featuredImg.src = this.getAttribute('data-full') || this.src;
    });
  });
  
  // Make first thumbnail active by default
  if (thumbnails.length > 0) {
    thumbnails[0].classList.add('active');
  }
  
  // Full description accordion toggle
  const fullDescHeader = document.getElementById('full-description-header');
  const fullDescContent = document.getElementById('full-description-content');
  
  if (fullDescHeader && fullDescContent) {
    fullDescHeader.addEventListener('click', function() {
      const icon = this.querySelector('.expand-icon');
      
      if (fullDescContent.classList.contains('active')) {
        fullDescContent.classList.remove('active');
        if (icon) icon.style.transform = 'rotate(0deg)';
      } else {
        fullDescContent.classList.add('active');
        if (icon) icon.style.transform = 'rotate(180deg)';
      }
    });
  }
  
  // Model accordions
  const modelAccordions = document.querySelectorAll('.model-accordion');
  
  modelAccordions.forEach(accordion => {
    const header = accordion.querySelector('.model-accordion-header');
    const content = accordion.querySelector('.model-accordion-content');
    const icon = header.querySelector('.expand-icon');
    
    if (header && content) {
      // Show first model by default
      if (accordion === modelAccordions[0]) {
        accordion.classList.add('active');
        if (icon) icon.style.transform = 'rotate(180deg)';
      } else {
        content.style.display = 'none';
      }
      
      header.addEventListener('click', function(e) {
        // Don't toggle if clicking the quote button
        if (e.target.closest('.quote-button')) {
          return;
        }
        
        const isActive = accordion.classList.contains('active');
        
        if (isActive) {
          accordion.classList.remove('active');
          content.style.display = 'none';
          if (icon) icon.style.transform = 'rotate(0deg)';
        } else {
          accordion.classList.add('active');
          content.style.display = 'block';
          if (icon) icon.style.transform = 'rotate(180deg)';
        }
      });
    }
  });
  
  // Specification accordions
  const accordions = document.querySelectorAll('.faq-accordion');
  
  accordions.forEach(accordion => {
    const heading = accordion.querySelector('.heading');
    const content = accordion.querySelector('.spec-content');
    const icon = heading.querySelector('.expand-icon');
    
    if (heading && content) {
      heading.addEventListener('click', function() {
        // Close all other accordions first
        accordions.forEach(acc => {
          if (acc !== accordion && acc.classList.contains('active')) {
            acc.classList.remove('active');
            const accIcon = acc.querySelector('.heading .expand-icon');
            if (accIcon) accIcon.style.transform = 'rotate(0deg)';
          }
        });
        
        // Toggle current accordion
        if (accordion.classList.contains('active')) {
          accordion.classList.remove('active');
          if (icon) icon.style.transform = 'rotate(0deg)';
        } else {
          accordion.classList.add('active');
          if (icon) icon.style.transform = 'rotate(180deg)';
        }
      });
    }
  });
});
</script>
{% endblock %}
